# 智能外卖柜样机 - 应用层配置文件
# Application Layer Configuration File

[daemon_config]
# 守护进程Socket路径
gpio_control_socket = /tmp/gpio.sock
gpio_monitor_socket = /tmp/gpio_get.sock
ht1621_socket = /tmp/ht1621.sock
keyboard_monitor_socket = /tmp/keyboard_get.sock

[state_machine]
# 状态机配置
# 状态转换超时时间（秒）
state_transition_timeout = 30

# 验证码有效期（秒）
pickup_code_validity = 3600

# 验证码重试次数
pickup_code_max_retries = 3

[door_control]
# 门锁控制配置
# 门锁通电时间限制（秒）- 严格限制，超过会烧坏门锁
door_lock_pulse_duration = 1.0

# 门锁断电延迟（秒）- 确保门锁完全断电
door_lock_off_delay = 0.1

# 门状态检测稳定时间（秒）
door_state_stabilization = 0.5

# 门打开超时时间（秒）- 超过此时间未关门则报警
door_open_timeout = 300

[ir_sensor]
# 红外传感器配置
# 红外检测稳定时间（秒）- 亚克力材料震动导致电平跳变
ir_sensor_stabilization = 2.0

# 红外传感器去抖动时间（秒）
ir_sensor_debounce = 0.5

# 物品检测阈值 - 任一传感器触发即判断为有物品
ir_sensor_detection_threshold = 1

[buzzer]
# 嗡鸣器配置
# 嗡鸣器初始电平（1=高电平停止，0=低电平触发）
buzzer_initial_level = 1

# 初始化提示音持续时间（秒）
buzzer_init_duration = 1.0

# 物品未取完提示闪烁次数
buzzer_item_not_taken_flash_count = 5

# 物品未取完提示闪烁持续时间（秒）
buzzer_item_not_taken_flash_duration = 1.0

# 物品未取完提示闪烁间隔时间（秒）
buzzer_item_not_taken_flash_interval = 0.5

[lcd]
# LCD显示配置
# 外卖员侧LCD设备ID
courier_lcd_device_id = 1

# 学生侧LCD设备ID
student_lcd_device_id = 2

# LCD背光GPIO编号
courier_lcd_backlight_gpio = 1
student_lcd_backlight_gpio = 2

# LCD背光默认状态（1=开启，0=关闭）
lcd_backlight_default = 0

# 显示刷新间隔（秒）
lcd_refresh_interval = 0.1

# 错误显示持续时间（秒）
lcd_error_display_duration = 3.0

# 超时显示持续时间（秒）
lcd_timeout_display_duration = 3.0

# LCD背光控制逻辑
# 外卖员侧背光：有验证码显示时亮灯，无验证码时灭灯
# 学生侧背光：有用户输入时亮灯，超时无输入时灭灯

# 学生侧输入超时时间（秒）- 超时后清除显示并关闭背光
student_input_timeout = 60

# 学生侧输入活动超时时间（秒）- 无新输入超过此时间则认为超时
student_input_activity_timeout = 60

[pickup_code]
# 取件码配置
# 取件码长度
pickup_code_length = 6

# 取件码字符集（0-9）
pickup_code_charset = 0123456789

# 取件码最小值
pickup_code_min = 100000

# 取件码最大值
pickup_code_max = 999999

# 取件码有效期（秒）- 超过此时间自动失效
pickup_code_validity_period = 3600

# 取件码使用后是否立即失效（1=是，0=否）
pickup_code_invalidate_after_use = 1

# 是否启用防重放攻击（1=是，0=否）
pickup_code_anti_replay = 1

# 防重放攻击时间窗口（秒）- 同一验证码在此时间内不能重复使用
pickup_code_replay_window = 300

# 是否验证码唯一性检查（1=是，0=否）
pickup_code_uniqueness_check = 1

# 历史验证码保留数量（用于唯一性检查）
pickup_code_history_size = 1000

# 随机数生成器配置
# 随机数生成器类型：system, secrets, random
pickup_code_random_generator = secrets

# 随机数种子（仅用于random模式，留空自动生成）
pickup_code_random_seed =

[keyboard]
# 键盘输入配置
# 键盘输入超时时间（秒）
keyboard_input_timeout = 60

# 键盘输入缓冲区大小
keyboard_input_buffer_size = 10

# 支持的按键（数字键）
# 包含主键盘数字键和小键盘数字键
keyboard_supported_keys = 0,1,2,3,4,5,6,7,8,9

# 小键盘数字键映射（Linux key codes）
# 小键盘0-9的key codes: 82,79,80,81,75,76,77,71,72,73
keyboard_numpad_keys = 82,79,80,81,75,76,77,71,72,73

# 支持的功能键
keyboard_function_keys = ENTER,BACKSPACE,KP_MINUS

# 小键盘减号（KP_MINUS）用作删除键
# Linux key code for KP_MINUS is 74
keyboard_delete_key = KP_MINUS

# ENTER键用于提交验证码
# Linux key code for ENTER is 28
keyboard_submit_key = ENTER

[initialization]
# 初始化配置
# 初始化按钮长按时间（秒）
init_button_long_press_duration = 5.0

# 初始化按钮GPIO编号
init_button_gpio = 3

# 初始化超时时间（秒）- 超过此时间未初始化则进入待机
init_timeout = 300

[emergency]
# 紧急开门配置
# 紧急按钮长按时间（秒）
emergency_button_long_press_duration = 5.0

# 紧急按钮GPIO编号
emergency_button_gpio = 3

# 紧急开门持续时间（秒）
emergency_door_open_duration = 30

[retry]
# 重试机制配置
# 门锁失败重试次数
door_lock_retry_count = 3

# 门锁重试间隔（秒）
door_lock_retry_interval = 1.0

# SPI通信失败重试次数
spi_retry_count = 3

# SPI重试间隔（秒）
spi_retry_interval = 0.5

# Socket连接失败重试次数
socket_retry_count = 5

# Socket重试间隔（秒）
socket_retry_interval = 2.0

[logging]
# 日志配置
# 日志级别：DEBUG, INFO, WARNING, ERROR, CRITICAL
log_level = INFO

# 日志文件路径
log_file = /var/log/delivery_box.log

# 日志文件最大大小（MB）
log_max_size = 10

# 日志文件备份数量
log_backup_count = 5

# 日志格式
log_format = %(asctime)s - %(name)s - %(levelname)s - %(message)s

[monitoring]
# 监控配置
# GPIO状态查询间隔（秒）
gpio_status_query_interval = 30

# 系统健康检查间隔（秒）
health_check_interval = 60

# 内存使用阈值（%）
memory_usage_threshold = 80

# CPU使用阈值（%）
cpu_usage_threshold = 80

[lighting]
# 照明配置
# 柜内照明GPIO编号
cabinet_light_gpio = 3

# 柜内照明自动开启（1=启用，0=禁用）
cabinet_light_auto_enable = 1

# 柜内照明延时关闭时间（秒）- 门关闭后延时关闭
cabinet_light_delay_off = 10

[safety]
# 安全配置
# 门锁通电最大时间（秒）- 硬件限制，不可修改
door_lock_max_pulse_duration = 1.0

# 门锁通电安全余量（秒）
door_lock_safety_margin = 0.1

# 紧急停止功能（1=启用，0=禁用）
emergency_stop_enable = 1

[debug]
# 调试配置
# 调试模式（1=启用，0=禁用）
debug_mode = 0

# 模拟模式（1=启用，0=禁用）- 无硬件测试
simulate_mode = 0

# 详细日志（1=启用，0=禁用）
verbose_logging = 0

# 显示详细状态信息（1=启用，0=禁用）
show_detailed_status = 0

[display_messages]
# LCD显示消息配置
# 注意：LCD只能显示8段数码管（0-9, A-F），无法显示完整单词
# 错误提示使用 Err+三位错误码 的方式（总共6位）

# 启动消息
msg_boot_courier = 1
msg_boot_student = 2
msg_boot_dash =      # 6个空格

# 状态消息
msg_idle =      # 6个空格

# 错误消息（Err+三位错误码）
# 错误码说明见 [error_codes] 章节
msg_error_format = Err001  # 格式错误
msg_error_notexist = Err002  # 验证码不存在
msg_error_expired = Err003  # 验证码已过期
msg_error_used = Err004  # 验证码已使用
msg_error_replay = Err005  # 验证码重复使用
msg_error_timeout = Err007  # 输入超时
msg_error_door = Err008  # 门锁故障
msg_error_ir = Err009  # 红外传感器异常
msg_error_system = Err099  # 系统错误

# 提示消息
msg_empty =      # 6个空格

[error_codes]
# 错误码定义表（Err+三位数字，总共6位）
# Err001: 输入格式错误（非6位数字）
# Err002: 验证码不存在（未生成）
# Err003: 验证码已过期（超过3600秒）
# Err004: 验证码已使用（已被使用过）
# Err005: 验证码重复使用（防重放攻击，300秒内）
# Err007: 输入超时（60秒无新输入）
# Err008: 门锁故障（门锁命令发送后门未打开）
# Err009: 红外传感器异常（持续跳变无法稳定）
# Err099: 系统错误（未知错误）

[timeouts]
# 各种超时配置
# 初始化超时（秒）
timeout_init = 300

# 外卖员操作超时（秒）
timeout_courier = 300

# 学生取件超时（秒）
timeout_student = 300

# 门打开超时（秒）
timeout_door_open = 300

# 键盘输入超时（秒）
timeout_keyboard = 60

# 验证码验证超时（秒）
timeout_code_verify = 30

[performance]
# 性能优化配置
# 事件处理循环间隔（秒）
event_loop_interval = 0.01

# 状态检查间隔（秒）
state_check_interval = 0.1

# GPIO状态更新缓冲时间（秒）
gpio_state_buffer_time = 0.05

# LCD显示更新缓冲时间（秒）
lcd_update_buffer_time = 0.05